import pybullet as p
import time
import math
import random
import pybullet_data
import numpy as np
from datetime import datetime

class graspTypes:

	
	def __init__(self, sawyerId):
		self._sawyerId = sawyerId
		self.jd = [0.0001] * 35
		self.js = [3, 4, 8, 9, 10, 11, 13, 16, 21, 22, 23, 26, 27, 28, 30, 31, 32, 35, 36 ,37, 39, 40, 41, 44, 45, 46, 48, 49, 50, 53, 54, 55, 58, 61, 64]

	######################################################### Hand Direct Control Functions ##########################################################################

	#control the lower joint and middle joint of pinky finger, range both [0.17 - 1.57]
	def pinkyF(self, lower, middle):
		if(lower < 0.17):
			lower = 0.17
		if(lower > 1.57):
			lower = 1.57
		if(middle < 0.17):
			middle = 0.17
		if(middle > 1.57):
			middle = 1.57	
		p.setJointMotorControlArray(bodyIndex=self._sawyerId,
		                        jointIndices=[21, 26, 22, 27],
		                        controlMode=p.POSITION_CONTROL,
		                        targetPositions=[lower, lower, middle, middle],
		                        targetVelocities=[0, 0, 0, 0],
		                        forces=[5000, 5000, 5000, 5000],
		                        positionGains=[0.03, 0.03, 0.03, 0.03],
		                        velocityGains=[1, 1, 1, 1])
		

	#control the lower joint and middle joint of ring finger, range both [0.17 - 1.57]
	def ringF(self, lower, middle):
		if(lower < 0.17):
			lower = 0.17
		if(lower > 1.57):
			lower = 1.57
		if(middle < 0.17):
			middle = 0.17
		if(middle > 1.57):
			middle = 1.57
		p.setJointMotorControlArray(bodyIndex=self._sawyerId,
		                        jointIndices=[30, 35, 31, 36],
		                        controlMode=p.POSITION_CONTROL,
		                        targetPositions=[lower, lower, middle, middle],
		                        targetVelocities=[0, 0, 0, 0],
		                        forces=[5000, 5000, 5000, 5000],
		                        positionGains=[0.03, 0.03, 0.03, 0.03],
		                        velocityGains=[1, 1, 1, 1])

	#control the lower joint and middle joint of mid finger, range both [0.17 - 1.57]
	def midF(self, lower, middle):
		if(lower < 0.17):
			lower = 0.17
		if(lower > 1.57):
			lower = 1.57
		if(middle < 0.17):
			middle = 0.17
		if(middle > 1.57):
			middle = 1.57
		p.setJointMotorControlArray(bodyIndex=self._sawyerId,
		                        jointIndices=[39, 44, 40, 45],
		                        controlMode=p.POSITION_CONTROL,
		                        targetPositions=[lower, lower, middle, middle],
		                        targetVelocities=[0, 0, 0, 0],
		                        forces=[5000, 5000, 5000, 5000],
		                        positionGains=[0.03, 0.03, 0.03, 0.03],
		                        velocityGains=[1, 1, 1, 1])

	#control the lower joint and middle joint of index finger, range both [0.17 - 1.57]
	def indexF(self, lower, middle):
		ls1 = p.getLinkState(self._sawyerId, 51)	
		if(lower < 0.17):
			lower = 0.17
		if(lower > 1.57):
			lower = 1.57
		if(middle < 0.17):
			middle = 0.17
		if(middle > 1.57):
			middle = 1.57
		p.setJointMotorControlArray(bodyIndex=self._sawyerId,
		                        jointIndices=[48, 53, 49, 54],
		                        controlMode=p.POSITION_CONTROL,
		                        targetPositions=[lower, lower, middle, middle],
		                        targetVelocities=[0, 0, 0, 0],
		                        forces=[5000, 5000, 5000, 5000],
		                        positionGains=[0.03, 0.03, 0.03, 0.03],
		                        velocityGains=[1, 1, 1, 1])


	#control the lower joint and middle joint of thumb, range: low [0.17 - 1.57], mid [0.34, 1.5]
	def thumb(self, lower, middle):
		if(lower < 0.85):
			lower = 0.85
		if(lower > 1.57):
			lower = 1.57
		if(middle < 0.34):
			middle = 0.34
		if(middle > 1.5):
			middle = 1.5
		p.setJointMotorControlArray(bodyIndex=self._sawyerId,
		                        jointIndices=[58, 61, 64],
		                        controlMode=p.POSITION_CONTROL,
		                        targetPositions=[lower, middle, middle],
		                        targetVelocities=[0, 0, 0],
		                        forces=[500, 500, 500],
		                        positionGains=[0.03, 0.03, 0.03],
		                        velocityGains=[1, 1, 1])


	def palmP(self, targetP, orientation): 

		jointP = [0]*65
		#jointPoses = p.calculateInverseKinematics(self._sawyerId, 19, targetP, targetOrientation = orientation, jointDamping=self.jd)
		jointPoses = p.calculateInverseKinematics(self._sawyerId, 38, targetP, targetOrientation = orientation, jointDamping=self.jd)
		j=0
		for i in self.js:
		        jointP[i] = jointPoses[j]
		        j=j+1
		
		for i in range(p.getNumJoints(self._sawyerId)):               
		        p.setJointMotorControl2(bodyIndex=self._sawyerId, 
		                                jointIndex=i, 
		                                controlMode=p.POSITION_CONTROL, 
		                                targetPosition=jointP[i], 
		                                targetVelocity=0, 
		                                force=500, 
		                                positionGain=0.03, 
		                                velocityGain=1)
		return jointP



	######################################################### Topologies #################################################################

	# handInitial = initial joint angles of hand 
	# format = [thumbl, thumbm, indexl, indexm, midl, midm, ringl, ringm, pinkl, pinkm]
	# class 1: Power palm add 3-5
	def poPmAd35(self):
		handInitial = [0.4960363955042402, 0.930942658951853, 0.41504235336690076, 0.4958417758131963, 0.9305144884658414, 0.1699739287830949, 0.5016231773066409, 0.9534671332625583, 						0.2895688070405733, 0.5013203826351587, 0.9510770834444713, 0.170000000732258, 0.5014573946482038, 0.9729337082604046, 0.17000046016304968, 0.5015814862418083, 					0.9734457849922248, 0.16999999999999996, 0.19940300521912468, 0.6061212952053325, 0.1700000015820287, 0.19917527455081288, 0.6049848247991039, 						0.17001142180319043, 0.9, 0.5049226620166328, 0.5048410653131918]
		maxRange = [1.57, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
		return 	handInitial, maxRange

	# class 2: Power palm abd 2-5
	def poPmAb25(self):
		handInitial = [0.1952475842471777, 0.9630382638496557, 0.2054150402458616, 0.19659153404223967, 0.9658312685121436, 0.16999685105399526, 0.2673957657395254, 1.0467383474819074, 0.22293695732192456, 0.25490599766419086, 1.0556313137744604, 0.1700010196027777, 0.4337580080793083, 1.0310072762664155, 0.16999997605207418, 0.4338906118648125, 1.033002345783696, 0.16999999928030013, 0.3591656399903722, 1.0102628447233089, 0.16999790881006444, 0.35851870447240436, 1.007512299651809, 0.16999998823329898, 1.2384275481991973, 0.3425619631886157, 0.3423530001991418]
		maxRange = [1.57, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
		return 	handInitial, maxRange

	# class3: Power palm add 2-5
	def poPmAd25(self):
		handInitial = [0.16999586068589015, 1.1369875108658696, 0.16999523367560745, 0.16998223923963046, 1.1383729345662124, 0.1699783745257798, 0.3493887832852244, 1.0295845748224919, 					0.17000074335076834, 0.3530829136957731, 1.0270718488795998, 0.17004309566521847, 0.5905454984010912, 0.971142299386193, 0.17005696187821134, 0.5904100964152337, 					0.9710732158175535, 0.17015396691091986, 0.5094522686402262, 0.9714336115792476, 0.1701359964893139, 0.5089929590085163, 0.9730273884810644, 0.17003181478405494, 					0.8499999999998946, 0.400711991356121, 0.4007046758277727]

		maxRange = [1.57, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
		return 	handInitial, maxRange

	#class4: Power pad abd 2
	def poPdAb2(self):
		handInitial = [0.19625168094302514, 0.1715461081990094, 0.1699995510473692, 0.19491122273406242, 0.16989785912108757, 0.1700000084297119, 0.19792794923547438, 0.17351162825430644, 0.1699999901215436, 0.18451641213354314, 0.17131209188137422, 0.1700109907049762, 0.17464230626301927, 0.1746409207481073, 0.17001145425117598, 0.17269629150427873, 0.17732404018091133, 0.16999999999999996, 0.3318638136639579, 1.3214508114395118, 0.16997041304056915, 0.33109768895918795, 1.3202151753703744, 0.16999886547565018, 1.3345732294083887, 0.34021295574258725, 0.34005287975244813]
		maxRange = [1.57, 1.5, 1.57, 1.57, 0.17, 0.17, 0.17, 0.17, 0.17, 0.17]		
		return 	handInitial, maxRange

	# class5: Power pad abd 2-3
	def poPdAb23(self):
		handInitial = [1.5700018877738353, 1.5685818591491179, 0.29037351436196507, 1.5700354114460422, 1.569580104079926, 0.5152029841429613, 1.5700278737368765, 1.567363278582146, 0.365079141180928, 1.5685548824126379, 1.5700000000000005, 0.1701203502460775, 0.3157377445469157, 1.391050293495002, 0.17015869693538585, 0.3160287484141266, 1.3934169836561328, 0.17010667646765593, 0.3297571978247499, 1.325848268388217, 0.1699992975891613, 0.3290626748513733, 1.3243915390344156, 0.1701609867518028, 1.3336946368699338, 0.3424002203093657, 0.3416802953733278]

		maxRange = [1.57, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
		return 	handInitial, maxRange

	# class6: Power pad abd 2-4
	def poPdAb24(self):
		handInitial = [1.570156773973495, 1.5575271295025637, 0.47296852152508806, 1.5700096291842605, 1.560228877941461, 1.0518495948815705, 0.24981162490140224, 1.2315766651333173, 0.31274828723616477, 0.24018698485937207, 1.238165330799669, 0.17019107157470026, 0.3151693577165825, 1.3902312437387754, 0.17014455236434295, 0.31541849503014596, 1.392587983054212, 0.17009053474312918, 0.32900009201417313, 1.3279766354922091, 0.16999999999999996, 0.328288814737806, 1.3265882312600263, 0.17013712963549446, 1.3334120615272302, 0.3431465498692273, 0.3425119960279883]
		maxRange = [1.57, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]		
		return 	handInitial, maxRange

	# class7: Intermediate abd 2
	def iAb2(self):
		handInitial = [1.5700010438879823, 1.5680908284326875, 0.16983510189776072, 1.5700335586716394, 1.5682816130061927, 0.1699801768741871, 1.5700048351472453, 1.569362992531869, 					0.16994127417107563, 1.5690749284710788, 1.570019502829786, 0.17004870948656717, 0.7140993077531866, 0.5970815196027085, 0.17003870863180856, 0.7143410239030091, 					0.59802241403102, 0.16999999982907335, 0.7063755401217995, 0.6270528085499097, 0.169996749194967, 0.705911495738233, 0.6272953396560469, 0.17001596941853367, 					0.8499998823631506, 0.3411429996891343, 0.3408718120579897]
		maxRange = [0.17, 0.34, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]			
		return 	handInitial, maxRange

	#class8: Intermediate add 2
	def iAd2(self):
		handInitial =  [1.5700015195270984, 1.5669901801715158, 0.16979833057969126, 1.5700441551313633, 1.567210833976385, 0.1699822901568983, 1.569993607788369, 1.5691075304971438, 					0.16993662105353685, 1.5690890943553635, 1.5697714401523863, 0.1699990377145865, 1.5694466195594325, 1.5700038112237276, 0.17004594254097566, 1.5696941074623052, 					1.5700000005619599, 0.17005052070049895, 0.46440658564398873, 1.3045934690333627, 0.1700155909983615, 0.4639425894146336, 1.3050221260138548, 0.170061149660053, 					0.8499989136950149, 0.3402829450011034, 0.34002234065213416]
		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]	
		return 	handInitial, maxRange		

	#class9: Intermediate add 3
	def iAd3(self):
		handInitial = [1.5700010600557293, 1.5663582436339418, 0.1698166428034453, 1.5700406082608085, 1.5667216072831869, 0.16998570568346258, 1.5700109044524817, 1.5691173699803955, 				0.169962928232291, 1.5693605809762814, 1.5695049359342248, 0.16999805984458066, 1.5688928998177967, 1.5700041135371419, 0.17002821005852395, 1.5691445054697601, 					1.5700000000000005, 0.17003451053645585, 0.46405624779489074, 1.4961013684934383, 0.17002971576371237, 0.463627356888278, 1.4965981067075798, 0.17005212826868166, 					1.1227829053239333, 0.3405899144632725, 0.3403195121474089]
		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]			
		return 	handInitial, maxRange

	#class10: Precision pad abd 2 
	def pPdAb2(self):
		handInitial = [0.18198316704567533, 0.17100540435682773, 0.16993307326862692, 0.18184598939871294, 0.16991226273740223, 0.16999958516251687, 0.18306759793023833, 0.17250764823670175, 0.16998592843450183, 0.17184620305704293, 0.17014690928711246, 0.1700109908253605, 0.1719675006705064, 0.1722725729718039, 0.17001114261750602, 0.1700640247631109, 0.1748868233159966, 0.16999999999999996, 0.2871664408150623, 1.2264396896204761, 0.17000001627988476, 0.28647117425269963, 1.2246827217782146, 0.16999975602330533, 1.3991470141502078, 0.34072108943427004, 0.3405645869044241]
		maxRange = [0.17, 1.5, 1.57, 1.57, 0.17, 0.17, 0.17, 0.17, 0.17, 0.17]			
		return 	handInitial, maxRange

	#class11: Precision pad abd 2-3
	def pPdAb23(self):
		handInitial = [1.5700015776744687, 1.5685462285594771, 0.17561056160841215, 1.5700618234253076, 1.5684146277165993, 0.19676337608932667, 1.5700199705895688, 1.5694099117227716, 0.1699199128006597, 1.5688282487757756, 1.5700000000000005, 0.17006689664048938, 0.4052432164096064, 1.2009040266156898, 0.17007507794248988, 0.4054205800744299, 1.2018999183335939, 0.17003400464857457, 0.2873842116487762, 1.2239875924658843, 0.16999942281724445, 0.2869496075346493, 1.2239366548077608, 0.1700868682274517, 1.3993536971094578, 0.3405121217123628, 0.34014373178509405]

		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]			
		return 	handInitial, maxRange

	#class12: Precision pad abd 2-4
	def pPdAb24(self):
		handInitial = [1.5700240280919915, 1.564920691574828, 0.25302004871912737, 1.570067725616701, 1.5675759257478563, 0.33975246834019285, 0.32954627423040944, 1.0108106343944223, 0.2211081909250083, 0.31988792498701885, 1.0170481267457991, 0.1701613807336486, 0.40367553688510593, 1.1993541919281818, 0.1701174730842806, 0.40387501770749235, 1.201950295200519, 0.16999992596513064, 0.2853473820941337, 1.2318005056523365, 0.16999999435044352, 0.2847329562782465, 1.229794741345592, 0.17014042060480314, 1.3984624548603897, 0.3425808326254205, 0.34193469157836626]

		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]			
		return 	handInitial, maxRange

	#class13: Precision pad abd 2-5
	def pPdAb25(self): # updated
		handInitial = [0.515830316721963, 0.7007194617709966, 0.6107030318249185, 0.5166341071758446, 0.7037886096552028, 0.21571297775824286, 0.5175583511949364, 0.8350009411745282, 0.39728444570704124, 0.5035660701483949, 0.8454838368030184, 0.16999999341261635, 0.4046220076889183, 1.2000895456681402, 0.16999999999999996, 0.4048262906429902, 1.202016720687749, 0.1699999779632157, 0.28629461700591846, 1.2319442547589183, 0.1699712352248026, 0.2856708673021038, 1.230047928326977, 0.16999866700191293, 1.3158729768521846, 0.3413658341867759, 0.3411590289646416]


		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]		
		return 	handInitial, maxRange

	#class14: Precision pad add 2-5
	def pPdAd25(self):
		handInitial = [0.22152291659747883, 0.9817759152539315, 0.16999407449044338, 0.2215143810144337, 0.9823135574132803, 0.1699989274565554, 0.5739483012567052, 0.5902239466515086, 					0.1699767141257003, 0.5739640367999089, 0.5899904373506896, 0.17000733012736757, 0.9361331354216027, 0.26548528122516185, 0.17000335607201394, 0.93630346854007, 					0.2656232807802453, 0.17001488487220198, 0.906821961784849, 0.25019764084658785, 0.17007600796776692, 0.906618391328536, 0.25115462875714, 0.16999999912072705, 				1.5698416936818693, 0.3400976317456705, 0.3400749247584485]
		maxRange = [0.17, 1.5, 1.57, 0.17, 1.57, 0.17, 1.57, 0.17, 1.57, 0.17]			
		return 	handInitial, maxRange

	#class15: Precision side abd 3
	def pSAb3(self):
		handInitial = [1.5700094952684058, 1.5690857481649652, 0.16972816981211833, 1.5699895890763627, 1.5692665040624554, 0.16999027933789598, 1.5124725117753082, 1.5686388115197312, 					0.16999592456146592, 1.510173800971141, 1.570012514108628, 0.17008649923552688, 1.3998130395358097, 1.5699991322072562, 0.17003022445968818, 1.4001451641651554, 					1.5700000000000005, 0.170111437359268, 0.17000037050461883, 1.547303775073415, 0.17012075313557448, 0.16998435594742317, 1.5472775617987753, 0.17014775406102817, 					0.8500009033094241, 0.34037032647730703, 0.34004164836116546]
		maxRange = [0.17, 1.5, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]	
		return 	handInitial, maxRange



		

